{%- assign course_sort = site.data.teaching | sort: "year" -%}
{%- assign course_by_year = course_sort | group_by:"year" -%}
{%- assign course_by_inst = course_sort | group_by:"institution" -%}

{%- assign years_list = course_by_year | map: 'name' -%}
{%- assign courses_per_year_list = course_by_year | map: 'items' -%}



<!------------------------------------------- Institutions  ---------------------------------->

<!-- Open bracket of parent -->
{%- assign sep_institution = "[" -%}
	
<!--- Get all courses per year --->
{%- for courses_per_year in courses_per_year_list -%}
	{%- assign courses_per_year_sort = courses_per_year | sort: "institution" -%}
	
	<!-- Open bracket of child -->
	{%- assign sep_tmp_institution = "" -%}
	
	<!-- Go through institutions -->
	{%- for course in courses_per_year_sort -%}
		{%- assign sep_tmp_institution = sep_tmp_institution | append: "," -%}
		{%- assign sep_tmp_institution = sep_tmp_institution | append: course.institution -%}
	{%- endfor -%}
	
	<!-- Keep unique list -->
	{%- assign sep_tmp_institution = sep_tmp_institution | remove_first: "," -%}
	{%- assign temporary = sep_tmp_institution | split: "," -%}
	{%- assign unique_inst = temporary | uniq | join: "," -%}

	<!-- Open and close bracket -->
	{%- assign unique_inst = unique_inst | prepend: "[" -%}
	{%- assign unique_inst = unique_inst | append: "]" -%}

	<!-- Append to parent sepator -->
	{%- assign sep_institution = sep_institution | append: "#" -%}
	{%- assign sep_institution = sep_institution | append: unique_inst -%}
	
{%- endfor -%}

<!-- Close bracket and remove first separator -->
{%- assign sep_institution = sep_institution | append: "]" -%}
{%- assign sep_institution = sep_institution | remove_first: "#" -%}

<a>{{ sep_institution }}</a>

<!------------------------------------------- Course Titles ---------------------------------->

<!-- Open bracket of parent -->
{%- assign sep_title = "[" -%}
	
<!--- Get all courses per year --->
{%- for courses_per_year in courses_per_year_list -%}
	{%- assign courses_per_year_sort = courses_per_year | sort: "institution" -%}
	
	<!-- Open bracket of child -->
	{%- assign sep_tmp_title = "[" -%}
	
	<!-- Go through course titles -->
	{%- for course in courses_per_year_sort -%}
		{%- assign sep_tmp_title = sep_tmp_title | append: "," -%}
		{%- assign sep_tmp_title = sep_tmp_title | append: course.title -%}
	{%- endfor -%}
	
	<!-- Close bracket of child -->
	{%- assign sep_tmp_title = sep_tmp_title | append: "]" -%}
	
	<!-- Remove first separator -->
	{%- assign sep_tmp_title = sep_tmp_title | remove_first: "," -%}
	
	<!-- Append to parent sepator -->
	{%- assign sep_title = sep_title | append: "#" -%}
	{%- assign sep_title = sep_title | append: sep_tmp_title -%}

{%- endfor -%}

<!-- Close bracket and remove first separator -->
{%- assign sep_title = sep_title | append: "]" -%}
{%- assign sep_title = sep_title | remove_first: "#" -%}

<br><br>
<a>{{ sep_title }}</a>


<!------------------------------------------- Course Hours ---------------------------------->

<!-- Open bracket of parent -->
{%- assign sep_hour = "[" -%}
	
<!--- Get all courses per year --->
{%- for courses_per_year in courses_per_year_list -%}
	{%- assign courses_per_year_sort = courses_per_year | sort: "institution" -%}
	{%- assign courses_per_year_sort_group = courses_per_year_sort | group_by:"institution" -%}
	{%- assign institutions_this_year = courses_per_year_sort_group | map:'name' -%}
	
	
	<!-- Open bracket of child -->
	{%- assign sep_tmp_hour = "[" -%}
	
	<!-- Go through institutions -->
	{%- for inst in institutions_this_year -%}
		{%- assign sep_hour_inner = "[" -%}
		
		<!-- Go through courses-->
		{%- for course in courses_per_year_sort -%}
			{%- assign sep_hour_inner = sep_hour_inner | append: "," -%}
			
			{%- if course.institution == inst -%}
				{%- assign sep_hour_inner = sep_hour_inner | append: course.hours -%}
			{%- else -%}
				{%- assign sep_hour_inner = sep_hour_inner | append: "null" -%}
			{%- endif -%}
		
		{%- endfor -%}
		
		<!-- Close bracket and remove first separator of child -->
		{%- assign sep_hour_inner = sep_hour_inner | append: "]" -%}
		{%- assign sep_hour_inner = sep_hour_inner | remove_first: "," -%}
		
		<!-- Add to the direct parent -->
		{%- assign sep_tmp_hour = sep_tmp_hour | append: ";" -%}
		{%- assign sep_tmp_hour = sep_tmp_hour | append: sep_hour_inner -%}

	{%- endfor -%}
	
	<!-- Close bracket and remove first separator of child -->
	{%- assign sep_tmp_hour = sep_tmp_hour | append: "]" -%}
	{%- assign sep_tmp_hour = sep_tmp_hour | remove_first: ";" -%}
	
	<!-- Add to the direct parent -->
	{%- assign sep_hour = sep_hour | append: "#" -%}
	{%- assign sep_hour = sep_hour | append: sep_tmp_hour -%}

{%- endfor -%}

<!-- Close bracket and remove first separator of child -->
{%- assign sep_hour = sep_hour | append: "]" -%}
{%- assign sep_hour = sep_hour | remove_first: "#" -%}

<br><br>
<a>{{ sep_hour }}</a>


<canvas id="teaching-canvas"></canvas>


<!--- Create one button for each year --->
{% for year in years_list %}
{% capture year_str %}{{year}}{% endcapture %}
  <button id="btn-{{ year_str }}">{{year_str}}</button>
{% endfor %}



<script>

var data = {
    labels: ["January", "February", "March", "April", "May", "June"],
    datasets: [
        {
            fillColor: "#79D1CF",
            strokeColor: "#79D1CF",
            data: [null, null, 81, 56, 55, 44]
        },
        {
            backgroundColor: "#26AA5A",
            borderColor: "#26AA5A",
            data: [60, 80,null,null,null,null]
        }
    ]
};


var data2 = {
    labels: ["January", "February", "March", "April", "May", "June"],
    datasets: [
        {
            fillColor: "#79D1CF",
            strokeColor: "#79D1CF",
            data: [null, 20, 54, 35, 78, null]
        },
        {
            backgroundColor: "#26AA5A",
            borderColor: "#26AA5A",
            data: [60, null,null,null,null,55]
        }
    ]
};


var barOptions = {
	hover: {
	  mode: 'nearest',
	  intersect: true
	},
	responsive: true,
	scales: {
		yAxes: [{
		    ticks: {
		    	 display: false,
		        fontColor: textcolor,
		    },
		    stacked: true,
		    gridLines: {
		    	display: false,
		    },
		}],
		xAxes: [{
		    ticks: {
		        beginAtZero: true
		    },
		    gridLines: {
		    	display: false,
		    },
		}]
	},
	events: true,
		showTooltips: true,
		animation: {
		    duration: 500,
		    easing: "easeOutQuart",
	}
};

// ON LOAD
var ctx = document.getElementById("teaching-canvas").getContext("2d");
var myBar = new Chart(ctx, {
		type: 'horizontalBar',
		data: data,
		options: barOptions,
	    });

// CHANGE DATA
document.getElementById('btn-2013-2014').addEventListener('click', function() {
	myBar.data = data2
	});
      myBar.update();
});


</script>



